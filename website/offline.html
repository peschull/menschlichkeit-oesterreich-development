<!doctype html>
<html lang="de" dir="ltr">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Offline - Menschlichkeit √ñsterreich</title>

    <style>
      * {
        box-sizing: border-box;
        margin: 0;
        padding: 0;
      }

      body {
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: #fff;
        min-height: 100vh;
        display: flex;
        align-items: center;
        justify-content: center;
        text-align: center;
        padding: 1rem;
      }

      .offline-container {
        max-width: 600px;
        padding: 2rem;
        background: rgba(255, 255, 255, 0.1);
        backdrop-filter: blur(10px);
        -webkit-backdrop-filter: blur(10px);
        border-radius: 20px;
        border: 1px solid rgba(255, 255, 255, 0.2);
        box-shadow: 0 25px 45px rgba(0, 0, 0, 0.1);
      }

      .offline-icon {
        font-size: 4rem;
        margin-bottom: 1rem;
        opacity: 0.8;
      }

      h1 {
        font-size: 2.5rem;
        font-weight: 700;
        margin-bottom: 1rem;
        line-height: 1.2;
      }

      p {
        font-size: 1.1rem;
        line-height: 1.6;
        margin-bottom: 2rem;
        opacity: 0.9;
      }

      .btn {
        display: inline-block;
        padding: 0.75rem 2rem;
        background: rgba(255, 255, 255, 0.2);
        color: #fff;
        text-decoration: none;
        border-radius: 50px;
        border: 2px solid rgba(255, 255, 255, 0.3);
        font-weight: 600;
        transition: all 0.3s ease;
        margin: 0.5rem;
      }

      .btn:hover,
      .btn:focus {
        background: rgba(255, 255, 255, 0.3);
        border-color: rgba(255, 255, 255, 0.5);
        transform: translateY(-2px);
        box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
      }

      .btn-primary {
        background: #2563eb;
        border-color: #2563eb;
      }

      .btn-primary:hover,
      .btn-primary:focus {
        background: #1d4ed8;
        border-color: #1d4ed8;
      }

      .connection-status {
        margin-top: 2rem;
        padding: 1rem;
        background: rgba(255, 255, 255, 0.1);
        border-radius: 10px;
        display: none;
      }

      .connection-status.online {
        background: rgba(34, 197, 94, 0.2);
        border: 1px solid rgba(34, 197, 94, 0.3);
        display: block;
      }

      .connection-status.offline {
        background: rgba(239, 68, 68, 0.2);
        border: 1px solid rgba(239, 68, 68, 0.3);
        display: block;
      }

      .logo {
        margin-bottom: 2rem;
      }

      .heart {
        color: #ef4444;
        animation: pulse 2s infinite;
      }

      @keyframes pulse {
        0% {
          transform: scale(1);
        }
        50% {
          transform: scale(1.1);
        }
        100% {
          transform: scale(1);
        }
      }

      .features {
        margin-top: 2rem;
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
        gap: 1rem;
        text-align: left;
      }

      .feature {
        padding: 1rem;
        background: rgba(255, 255, 255, 0.1);
        border-radius: 10px;
      }

      .feature-icon {
        font-size: 1.5rem;
        margin-bottom: 0.5rem;
        display: block;
      }

      .feature h3 {
        font-size: 0.9rem;
        font-weight: 600;
        margin-bottom: 0.25rem;
      }

      .feature p {
        font-size: 0.8rem;
        margin: 0;
        opacity: 0.8;
      }

      @media (max-width: 768px) {
        h1 {
          font-size: 2rem;
        }
        .offline-icon {
          font-size: 3rem;
        }
        .features {
          grid-template-columns: 1fr;
        }
      }
    </style>
  </head>

  <body>
    <div class="offline-container">
      <!-- Logo -->
      <div class="logo">
        <span style="font-size: 2rem">‚ù§Ô∏è</span>
        <h2 style="margin: 0.5rem 0; font-size: 1.2rem; font-weight: 600">
          Menschlichkeit √ñsterreich
        </h2>
      </div>

      <!-- Offline Icon -->
      <div class="offline-icon">üì°</div>

      <!-- Main Message -->
      <h1>Sie sind offline</h1>

      <p>
        Keine Internetverbindung verf√ºgbar. Einige Inhalte sind auch offline verf√ºgbar. Sobald Sie
        wieder online sind, k√∂nnen Sie auf alle Funktionen zugreifen.
      </p>

      <!-- Action Buttons -->
      <div style="margin-bottom: 2rem">
        <button class="btn btn-primary" onclick="location.reload()" id="retryBtn">
          üîÑ Erneut versuchen
        </button>

        <a href="/" class="btn" onclick="return handleOfflineNavigation(event, '/')">
          üè† Zur Startseite
        </a>
      </div>

      <!-- Connection Status -->
      <div class="connection-status" id="connectionStatus">
        <strong id="statusText">Verbindung wird √ºberpr√ºft...</strong>
        <div style="margin-top: 0.5rem">
          <small id="statusDetails">Bitte warten Sie einen Moment.</small>
        </div>
      </div>

      <!-- Available Features -->
      <div class="features">
        <div class="feature">
          <span class="feature-icon">üìñ</span>
          <h3>Offline-Inhalte</h3>
          <p>Grundlegende Informationen √ºber den Verein sind verf√ºgbar</p>
        </div>

        <div class="feature">
          <span class="feature-icon">üíæ</span>
          <h3>Daten gespeichert</h3>
          <p>Ihre Eingaben werden automatisch gespeichert</p>
        </div>

        <div class="feature">
          <span class="feature-icon">üîÑ</span>
          <h3>Auto-Sync</h3>
          <p>Synchronisation erfolgt automatisch wenn online</p>
        </div>
      </div>
    </div>

    <script>
      // Connection Status Management
      class OfflineManager {
        constructor() {
          this.statusElement = document.getElementById('connectionStatus');
          this.statusText = document.getElementById('statusText');
          this.statusDetails = document.getElementById('statusDetails');
          this.retryButton = document.getElementById('retryBtn');

          this.init();
        }

        init() {
          this.updateConnectionStatus();
          this.bindEvents();
          this.startConnectionMonitoring();
        }

        bindEvents() {
          // Online/Offline events
          window.addEventListener('online', () => this.handleOnline());
          window.addEventListener('offline', () => this.handleOffline());

          // Retry button
          this.retryButton.addEventListener('click', () => this.handleRetry());

          // Keyboard shortcuts
          document.addEventListener('keydown', e => {
            if ((e.ctrlKey || e.metaKey) && e.key === 'r') {
              e.preventDefault();
              this.handleRetry();
            }
          });
        }

        updateConnectionStatus() {
          if (navigator.onLine) {
            this.showOnlineStatus();
          } else {
            this.showOfflineStatus();
          }
        }

        showOnlineStatus() {
          this.statusElement.className = 'connection-status online';
          this.statusText.textContent = '‚úÖ Verbindung wiederhergestellt';
          this.statusDetails.textContent = 'Sie k√∂nnen jetzt alle Funktionen nutzen.';

          // Auto-reload after connection is restored
          setTimeout(() => {
            if (navigator.onLine) {
              location.reload();
            }
          }, 2000);
        }

        showOfflineStatus() {
          this.statusElement.className = 'connection-status offline';
          this.statusText.textContent = '‚ùå Keine Internetverbindung';
          this.statusDetails.textContent = '√úberpr√ºfen Sie Ihre Netzwerkeinstellungen.';
        }

        handleOnline() {
          console.log('Connection restored');
          this.updateConnectionStatus();
        }

        handleOffline() {
          console.log('Connection lost');
          this.updateConnectionStatus();
        }

        handleRetry() {
          this.statusText.textContent = 'üîÑ Verbindung wird gepr√ºft...';
          this.statusDetails.textContent = 'Einen Moment bitte.';

          // Simulate connection check
          setTimeout(() => {
            this.updateConnectionStatus();
          }, 1000);
        }

        startConnectionMonitoring() {
          // Periodic connection check
          setInterval(() => {
            this.checkConnection();
          }, 5000);
        }

        async checkConnection() {
          try {
            const response = await fetch('/', {
              method: 'HEAD',
              mode: 'no-cors',
              cache: 'no-cache',
            });

            if (response.ok || response.type === 'opaque') {
              if (!navigator.onLine) {
                // Force online event
                window.dispatchEvent(new Event('online'));
              }
            }
          } catch (error) {
            if (navigator.onLine) {
              // Force offline event
              window.dispatchEvent(new Event('offline'));
            }
          }
        }
      }

      // Offline Navigation Handler
      function handleOfflineNavigation(event, url) {
        event.preventDefault();

        // Check if page is cached
        if ('caches' in window) {
          caches
            .match(url)
            .then(response => {
              if (response) {
                window.location.href = url;
              } else {
                alert('Diese Seite ist offline nicht verf√ºgbar. Versuchen Sie es sp√§ter erneut.');
              }
            })
            .catch(() => {
              alert('Diese Seite ist offline nicht verf√ºgbar. Versuchen Sie es sp√§ter erneut.');
            });
        } else {
          alert('Diese Seite ist offline nicht verf√ºgbar. Versuchen Sie es sp√§ter erneut.');
        }

        return false;
      }

      // Service Worker Update Handler
      if ('serviceWorker' in navigator) {
        navigator.serviceWorker.ready.then(registration => {
          // Check for updates
          registration.addEventListener('updatefound', () => {
            const newWorker = registration.installing;

            newWorker.addEventListener('statechange', () => {
              if (newWorker.state === 'installed') {
                if (navigator.serviceWorker.controller) {
                  // Show update notification
                  const updateNotification = document.createElement('div');
                  updateNotification.innerHTML = `
                  <div style="position: fixed; top: 1rem; right: 1rem; background: #2563eb; color: white; padding: 1rem; border-radius: 10px; z-index: 1000; max-width: 300px;">
                    <strong>Update verf√ºgbar</strong>
                    <p style="margin: 0.5rem 0 0 0; font-size: 0.9rem;">Eine neue Version der Website ist verf√ºgbar.</p>
                    <button onclick="updateServiceWorker()" style="margin-top: 0.5rem; background: white; color: #2563eb; border: none; padding: 0.25rem 0.5rem; border-radius: 5px; cursor: pointer;">
                      Aktualisieren
                    </button>
                  </div>
                `;
                  document.body.appendChild(updateNotification);
                }
              }
            });
          });
        });
      }

      function updateServiceWorker() {
        if ('serviceWorker' in navigator) {
          navigator.serviceWorker.controller.postMessage({ type: 'SKIP_WAITING' });
          window.location.reload();
        }
      }

      // Initialize offline manager
      document.addEventListener('DOMContentLoaded', () => {
        new OfflineManager();

        // Add some visual enhancements
        document.body.style.animation = 'fadeIn 0.5s ease-out';

        const style = document.createElement('style');
        style.textContent = `
        @keyframes fadeIn {
          from { opacity: 0; transform: translateY(20px); }
          to { opacity: 1; transform: translateY(0); }
        }
      `;
        document.head.appendChild(style);
      });

      // Analytics (if available)
      if (typeof gtag === 'function') {
        gtag('event', 'page_view', {
          page_title: 'Offline Page',
          page_location: window.location.href,
        });
      }
    </script>
  </body>
</html>
