```mermaid
flowchart TD
  A[Start: /mitglied-werden] --> B[Choose membership type]
  B --> C[Fill personal details]
  C --> D[Validate]
  D -->|ok| E[Choose payment method]
  E --> F1[SEPA: collect IBAN + mandate]
  E --> F2[CC: collect card via Stripe]
  F1 --> G[Create Civi contact + store mandate via APIv4]
  F2 --> H[Create PaymentIntent via API -> confirm in frontend]
  G --> I[Create Contribution record]
  H --> I
  I --> J[Send confirmation email + receipt]
  J --> K[Set membership status Current]
  D -->|fail| L[Show inline errors]
```