# üèõÔ∏è CiviCRM Interface - Menschlichkeit √ñsterreich

**Organisation:** Menschlichkeit √ñsterreich  
**CMS:** Drupal 10  
**CiviCRM Version:** 5.74+  
**Timezone:** Europe/Vienna  
**Basis-URL:** https://menschlichkeit-oesterreich.at

---

## üìã √úbersicht

Vollst√§ndiges CiviCRM-Interface f√ºr Mitgliederverwaltung, Spenden, Events, Marketing und Automatisierung.

### Kernkomponenten
1. **SearchKit Dashboards** - 360¬∞ Kontaktansicht, Spender-Analytics, Mitgliederstatus
2. **Formulare** - Webform/Afform f√ºr Spenden, Beitritt, Events, Profil-Selfservice
3. **Integrationen** - E-Mail, Zahlungen (Stripe/SEPA), Banking, Mailchimp
4. **Automatisierung** - CiviRules + n8n Workflows

---

## üéØ Interface-Struktur

### Hauptmen√º (Drupal)
```
Navigation
‚îú‚îÄ‚îÄ Startseite
‚îú‚îÄ‚îÄ √úber uns
‚îú‚îÄ‚îÄ Mitmachen
‚îÇ   ‚îú‚îÄ‚îÄ Mitglied werden (Webform)
‚îÇ   ‚îú‚îÄ‚îÄ Spenden (Webform)
‚îÇ   ‚îî‚îÄ‚îÄ Events (√úbersicht)
‚îú‚îÄ‚îÄ Community
‚îÇ   ‚îú‚îÄ‚îÄ Forum
‚îÇ   ‚îú‚îÄ‚îÄ Mitglieder-Profil (CiviCRM)
‚îÇ   ‚îî‚îÄ‚îÄ Demokratie-Spiele
‚îú‚îÄ‚îÄ Admin (ACL: authenticated)
‚îÇ   ‚îú‚îÄ‚îÄ CiviCRM Dashboard
‚îÇ   ‚îú‚îÄ‚îÄ SearchKit Dashboards
‚îÇ   ‚îú‚îÄ‚îÄ Mitgliederverwaltung
‚îÇ   ‚îú‚îÄ‚îÄ Spendenverwaltung
‚îÇ   ‚îî‚îÄ‚îÄ Event-Management
```

### CiviCRM Dashboards (Internal)
```
CiviCRM Home
‚îú‚îÄ‚îÄ Kontakt-360 (SearchKit)
‚îú‚îÄ‚îÄ Spender-Dashboard (SearchKit)
‚îú‚îÄ‚îÄ Mitglieder-Status (SearchKit)
‚îú‚îÄ‚îÄ Event-Teilnehmer Live (SearchKit)
‚îú‚îÄ‚îÄ Banking-Import (CiviBanking)
‚îî‚îÄ‚îÄ SEPA-Batches (CiviSEPA)
```

---

## üîç SearchKit Dashboards

### 1. Kontakt-360 √úbersicht (`contacts_360_overview`)

**Zweck:** Vollst√§ndige Kontaktansicht mit allen Aktivit√§ten

**Felder:**
- Contact ID, Name, E-Mail (primary)
- Gruppen (Smart + Static)
- Letzte Aktivit√§t (Typ, Datum)
- Jahresbeitr√§ge (SUM current year)
- Mitgliedsstatus (Current/Grace/Expired)
- Tags, Custom Fields

**Joins:**
```sql
Contact
‚îú‚îÄ‚îÄ LEFT JOIN Email (is_primary = 1)
‚îú‚îÄ‚îÄ LEFT JOIN GroupContact (status = 'Added')
‚îú‚îÄ‚îÄ LEFT JOIN Activity (via ActivityContact, ORDER BY activity_date DESC LIMIT 1)
‚îú‚îÄ‚îÄ LEFT JOIN Contribution (receive_date >= YEAR_START, GROUP BY contact_id)
‚îî‚îÄ‚îÄ LEFT JOIN Membership (status IN ['New','Current','Grace'])
```

**Filter:**
- Kontakttyp: Individual
- Nicht gel√∂scht (is_deleted = 0)
- Opt-Out ber√ºcksichtigen

**Display:** Table mit Pagination (25/50/100), Export CSV

**Actions:**
- "Kontakt √∂ffnen" ‚Üí `/civicrm/contact/view?reset=1&cid={contact_id}`
- "E-Mail senden" ‚Üí Quick Action
- "Aktivit√§t hinzuf√ºgen" ‚Üí Quick Action

---

### 2. Spender-Dashboard (`donor_dashboard`)

**Zweck:** Spenden-Analytics, Kohorten, Recurring-Tracking

**Felder:**
- Contact Name, E-Mail
- Lifetime Total (SUM all contributions)
- Current Year Total
- Anzahl Spenden
- Durchschnittsspende
- Letzte Spende (Datum, Betrag)
- Recurring? (Flag)
- Payment Methode (Stripe/SEPA)
- Kohorte (Einmalspender/Regular/Major Donor)

**Joins:**
```sql
Contact
‚îú‚îÄ‚îÄ INNER JOIN Contribution (contribution_status = 'Completed')
‚îú‚îÄ‚îÄ LEFT JOIN ContributionRecur (via contribution_recur_id)
‚îî‚îÄ‚îÄ LEFT JOIN PaymentProcessor (via payment_processor_id)
```

**Filter:**
- Nur Completed Contributions
- Financial Type: "Donation" OR "Membership Fee"
- Optional: Date Range

**Display:**
- Table (sortierbar nach Lifetime/Year)
- Card View (Top 10 Donors)

**Charts (optional via ChartKit Extension):**
- Pie: Payment Methods
- Bar: Monthly Trend (Last 12 months)
- Funnel: One-time ‚Üí Recurring Conversion

---

### 3. Mitglieder-Status Board (`members_status_board`)

**Zweck:** Mitgliedschafts-Monitoring, SEPA-Mandate, Mahnungen

**Felder:**
- Contact Name, E-Mail
- Membership Type (Supporter/Active/Champion)
- Status (New/Current/Grace/Expired)
- Start/End Date
- F√§lligkeit (End Date - TODAY)
- SEPA-Mandat vorhanden? (Boolean via CiviSEPA)
- Mandatsreferenz
- Letzte Zahlung (Datum)
- Mahnstufe (Custom Field)

**Joins:**
```sql
Contact
‚îú‚îÄ‚îÄ INNER JOIN Membership
‚îú‚îÄ‚îÄ LEFT JOIN ContributionRecur (via CiviSEPA mapping)
‚îî‚îÄ‚îÄ LEFT JOIN SepaMandate (via contact_id)
```

**Filter:**
- Membership Status: Current, Grace, Expired (next 30 days)
- Sortierung: End Date ASC

**Display:**
- Table mit Color Coding:
  - üü¢ Current + SEPA OK
  - üü° Grace Period
  - üî¥ Expired / No SEPA
- Bulk Actions: "Erinnerungs-Mail senden"

**Automations (via CiviRules):**
- 30 Tage vor Ablauf ‚Üí E-Mail "Mitgliedschaft verl√§ngern"
- 7 Tage nach Ablauf ‚Üí E-Mail "Mahnung 1"
- 14 Tage ‚Üí "Mahnung 2"

---

### 4. Event-Teilnehmer Live (`event_attendees_live`)

**Zweck:** Echtzeit-√úbersicht Events, Zahlungsstatus, Kommunikation

**Felder:**
- Event Name, Datum
- Contact Name, E-Mail
- Teilnehmerstatus (Registered/Attended/No-show)
- Betrag bezahlt (via Contribution)
- Zahlungsstatus (Pending/Completed)
- Best√§tigungs-Mail versendet? (Activity: "Event Confirmation")
- Check-In Status (Custom Field)

**Joins:**
```sql
Event
‚îú‚îÄ‚îÄ INNER JOIN Participant
‚îú‚îÄ‚îÄ LEFT JOIN Contact (via participant.contact_id)
‚îú‚îÄ‚îÄ LEFT JOIN ParticipantPayment ‚Üí Contribution
‚îî‚îÄ‚îÄ LEFT JOIN Activity (type = "Event Confirmation")
```

**Filter:**
- Event: Current & Upcoming
- Participant Status: Not "Cancelled"

**Display:**
- Grouped by Event
- Table pro Event mit Participants
- Quick Actions: "Check-In", "Send Reminder"

**Bulk Actions:**
- "Export Teilnehmerliste" (CSV)
- "Erinnerungs-Mail an alle Pending"

---

## üìù Formulare (Webform CiviCRM)

### 1. Spendenformular (`/spenden`)

**URL:** https://menschlichkeit-oesterreich.at/spenden

**Felder:**

**Kontakt (Contact)**
- Anrede (Prefix)
- Vorname* (First Name)
- Nachname* (Last Name)
- E-Mail* (Email)
- Telefon (Phone)
- Adresse (Address: Street, Postal Code, City)

**Spende (Contribution)**
- Betrag* (Amount) - Select (10, 25, 50, 100, Custom)
- Zweck (Financial Type) - Select (Allgemeine Spende, Projekt XY)
- Nachricht (Note)
- Recurring? (Checkbox) ‚Üí Erstellt ContributionRecur

**Datenschutz (Required)**
- [x] Datenschutzerkl√§rung akzeptiert* (Required)
- [ ] Newsletter abonnieren (Opt-In ‚Üí Gruppe "Newsletter")

**Payment Processor:**
- Stripe (Cards: Visa, Mastercard, Amex)

**Workflow:**
1. Submit ‚Üí Webform Handler
2. CiviCRM Contact: Create/Update (Dedupe Rule: Email)
3. CiviCRM Contribution: Create (Status: Pending)
4. Stripe Checkout Session ‚Üí Redirect
5. Webhook (success) ‚Üí Update Contribution Status: Completed
6. CiviRules Trigger: "Contribution Completed" ‚Üí Send Thank-You Email

**Thank-You Page:**
```
Vielen Dank f√ºr deine Spende!

Deine Spende von ‚Ç¨{amount} wurde erfolgreich verarbeitet.
Spendenquittung: [PDF Download]

[Button: Zur√ºck zur Startseite]
```

---

### 2. Mitglied werden (`/mitglied-werden`)

**URL:** https://menschlichkeit-oesterreich.at/mitglied-werden

**Felder:**

**Kontakt (Contact)**
- Anrede*, Vorname*, Nachname*
- E-Mail*, Telefon
- Geburtsdatum (Birth Date)
- Adresse (vollst√§ndig)

**Mitgliedschaft (Membership)**
- Typ* (Select)
  - Supporter (15 ‚Ç¨/Monat)
  - Active (30 ‚Ç¨/Monat)
  - Champion (50 ‚Ç¨/Monat)
- Start Datum (Default: TODAY)
- Zahlungsweise*:
  - SEPA-Lastschrift (empfohlen)
  - Stripe (Kreditkarte)

**SEPA (conditional: if SEPA selected)**
- IBAN* (Validation: AT...)
- Kontoinhaber* (Account Holder)
- [x] SEPA-Mandat erteilen* (Checkbox ‚Üí erzeugt SepaMandate)

**Datenschutz**
- [x] Datenschutzerkl√§rung*
- [ ] Newsletter
- [ ] Event-Einladungen

**Workflow:**
1. Submit ‚Üí Create Contact
2. Create Membership (Status: Pending)
3. IF SEPA:
   - Create SepaMandate (Type: RCUR)
   - Create ContributionRecur
   - Status ‚Üí Pending (first debit)
4. IF Stripe:
   - Create Subscription via Stripe API
   - Webhook ‚Üí Update Membership Status: New
5. Send "Willkommens-E-Mail" (CiviRules)

**Thank-You:**
```
Willkommen bei Menschlichkeit √ñsterreich!

Deine Mitgliedschaft wurde beantragt.

SEPA: Erste Abbuchung erfolgt in 5-7 Werktagen.
Stripe: Zahlung erfolgreich, Mitgliedschaft aktiv.

[Button: Zum Mitgliedsbereich]
```

---

### 3. Event-Anmeldung (`/events/{event-id}`)

**URL:** https://menschlichkeit-oesterreich.at/events/workshop-demokratie

**Felder:**

**Kontakt**
- Vorname*, Nachname*, E-Mail*
- Telefon (optional)

**Event (Participant)**
- Event: [Auto-filled from URL]
- Teilnehmer-Typ (Individual / Organization)
- Anzahl Personen (Default: 1)

**Preis-Set (conditional)**
- Regul√§r (20 ‚Ç¨)
- Erm√§√üigt (10 ‚Ç¨) - Studierende/Arbeitslose
- Gratis (0 ‚Ç¨) - Mitglieder

**Payment (if > 0 ‚Ç¨)**
- Stripe Checkout

**Custom Fields**
- Ern√§hrung (Vegetarisch/Vegan/Keine Einschr√§nkungen)
- Besondere Bed√ºrfnisse (Textarea)

**Workflow:**
1. Create Contact
2. Create Participant (Status: Pending)
3. IF Price > 0:
   - Create Contribution (via ParticipantPayment)
   - Stripe Checkout
   - Webhook ‚Üí Update Participant Status: Registered
4. ELSE:
   - Update Status: Registered
5. Send "Event-Best√§tigung" (CiviRules)

**Confirmation Email Template:**
```
Anmeldung best√§tigt: {event.title}

Hallo {contact.first_name},

deine Anmeldung wurde erfolgreich best√§tigt!

Event: {event.title}
Datum: {event.start_date}
Ort: {event.location}

Teilnehmer-Code: {participant.id}

[Button: Zum Kalender hinzuf√ºgen]
[Button: Event absagen]
```

---

### 4. Profil-Self-Service (`/mein-profil`)

**URL:** https://menschlichkeit-oesterreich.at/mein-profil

**Login:** Drupal User (authenticated)

**Felder (editable):**
- Name, E-Mail, Telefon
- Adresse
- Geburtsdatum
- Kommunikationspr√§ferenzen:
  - [ ] Newsletter
  - [ ] Event-Einladungen
  - [ ] Umfragen
- Privacy:
  - [ ] Profil √∂ffentlich sichtbar (im Forum)
  - [ ] Name in Spenderliste anzeigen

**SEPA-Mandate (readonly):**
- Liste aller Mandate (Reference, Status, Next Debit)
- Action: "Mandat widerrufen" (Status ‚Üí Cancelled)

**Mitgliedschaften (readonly):**
- Current Membership Type, Status, End Date
- Action: "Upgrade" (Formular √∂ffnen)

**Contributions (readonly):**
- Liste (Date, Amount, Type, Status, Receipt)

**GDPR Actions:**
- [Button: Datenexport anfordern] ‚Üí Queue Job
- [Button: Konto l√∂schen] ‚Üí Anonymization Request

**Workflow:**
- Update Contact via APIv4
- Log Activity: "Profile Updated"

---

## üé® Design & UX

### Theme Integration (Drupal)
- **Frontend:** Olivero (Drupal 10 Default) mit Custom Glassmorphismus
- **CiviCRM Admin:** Angepasste Farben (Primary: #0d6efd, Gradient: orange-red)

### Custom CSS (CiviCRM)
```css
/* /sites/default/files/civicrm/custom_css/menschlichkeit.css */

:root {
  --menschlichkeit-primary: #0d6efd;
  --menschlichkeit-gradient: linear-gradient(135deg, #ff6b35 0%, #f7931e 100%);
}

.crm-container {
  font-family: 'Inter', sans-serif;
}

.searchkit-card {
  background: rgba(255, 255, 255, 0.8);
  backdrop-filter: blur(10px);
  border: 1px solid rgba(255, 255, 255, 0.3);
  border-radius: 12px;
}

.btn-primary {
  background: var(--menschlichkeit-gradient);
  border: none;
}
```

### Mobile Optimization
- Alle SearchKit Displays: Responsive Tables (Horizontal Scroll)
- Webforms: Single-Column Layout on Mobile
- Touch-Friendly Buttons (min 44px)

---

## üîó Navigation & Shortcuts

### Admin Quick Links (Menu Block)
```
CiviCRM Shortcuts
‚îú‚îÄ‚îÄ Neuer Kontakt
‚îú‚îÄ‚îÄ Neue Spende erfassen
‚îú‚îÄ‚îÄ Event erstellen
‚îú‚îÄ‚îÄ Mailing versenden
‚îú‚îÄ‚îÄ Banking-Import
‚îî‚îÄ‚îÄ SEPA-Batches
```

### User Quick Actions (Frontend)
```
Mein Bereich
‚îú‚îÄ‚îÄ Profil bearbeiten
‚îú‚îÄ‚îÄ Meine Spenden
‚îú‚îÄ‚îÄ Meine Events
‚îú‚îÄ‚îÄ Mitgliedschaft verwalten
‚îî‚îÄ‚îÄ Pr√§ferenzen
```

---

## üìä Reports & Analytics

### Standard-Reports (CiviReport)
1. **Spenden-√úbersicht** (Year-over-Year, by Type)
2. **Mitglieder-Entwicklung** (New/Renewals/Lapses)
3. **Event-Teilnahme** (Attendance Rate, Revenue)
4. **SEPA-Statistik** (Mandate, Failed Debits)

### Custom Dashboards (SearchKit + ChartKit)
- **Fundraising Dashboard:**
  - YTD Total vs. Goal (Progress Bar)
  - Top 10 Donors (Card List)
  - Monthly Trend (Line Chart)
  - Payment Methods (Pie Chart)

- **Membership Dashboard:**
  - Active Members (Total)
  - Renewal Rate (%)
  - Expirations next 90 days (Table)
  - Cohort Breakdown (Stacked Bar)

---

## üîî Notifications & Alerts

### CiviRules Auto-Notifications
1. **Spende eingegangen:**
   - Trigger: Contribution Completed
   - Action: Send Email "Danke f√ºr deine Spende"
   - Delay: Immediate

2. **Mitgliedschaft l√§uft ab:**
   - Trigger: Membership End Date - 30 days
   - Condition: Status = Current
   - Action: Send Email "Verl√§ngerung"
   - Delay: Scheduled (daily cron)

3. **Event-Erinnerung:**
   - Trigger: Event Start Date - 3 days
   - Condition: Participant Status = Registered
   - Action: Send Email "Event-Reminder"

4. **Failed SEPA Debit:**
   - Trigger: SepaMandate Updated (Status = Failed)
   - Action: 
     - Send Email "Zahlung fehlgeschlagen"
     - Add Tag "Payment Issue"
     - Create Activity "Follow-up required"

### Admin Alerts (via n8n ‚Üí Slack/Email)
- Daily: Banking Import Errors
- Weekly: Membership Lapses
- Monthly: Financial Summary

---

## ‚ôø Accessibility (WCAG 2.1 AA)

### SearchKit
- ‚úÖ Keyboard Navigation (Tab, Arrow Keys)
- ‚úÖ Screen Reader Labels (aria-label)
- ‚úÖ Color Contrast ‚â• 4.5:1
- ‚úÖ Focus Indicators

### Webforms
- ‚úÖ Labels for all inputs
- ‚úÖ Error messages (inline + summary)
- ‚úÖ Required fields marked with *
- ‚úÖ ARIA live regions for dynamic content

### General
- ‚úÖ Skip Links (Jump to Content)
- ‚úÖ Semantic HTML (h1-h6 hierarchy)
- ‚úÖ Alt texts for images

---

## üîí Security & Permissions

### Roles & ACLs
| Role | Permissions |
|------|-------------|
| **Anonymous** | View public pages, submit forms |
| **Authenticated** | View own profile, edit preferences |
| **Member** | Access member area, view member directory |
| **Staff** | View all contacts, edit contributions, manage events |
| **Admin** | Full CiviCRM access, Financial ACLs, System settings |

### Financial ACLs
- **View Financial Data:** Staff, Admin
- **Edit Financial Data:** Admin only
- **Delete Contributions:** Admin only (with audit log)

### GDPR Compliance
- ‚úÖ Double Opt-In for Newsletter
- ‚úÖ Unsubscribe Links in all mailings
- ‚úÖ Data Export (Contact ‚Üí Download PDF/CSV)
- ‚úÖ Right to be Forgotten (Anonymization)
- ‚úÖ Consent Tracking (Activities)

---

## üìà Performance

### Caching
- **Drupal:** Page Cache, Dynamic Page Cache, BigPipe
- **CiviCRM:** Template Cache, Menu Cache

### Optimization
- **SearchKit:** Indexed columns (contact_id, email, last_modified_date)
- **Joins:** Efficient (LEFT JOIN only when necessary)
- **Pagination:** Max 100 rows per page
- **Lazy Loading:** Card displays load on scroll

### Monitoring
- **Slow Query Log:** Queries > 1s
- **Error Log:** PHP errors, CiviCRM exceptions
- **Uptime:** Pingdom/UptimeRobot

---

## üîÑ Data Flow

```
Frontend Form (Webform)
    ‚Üì
Webform Handler (CiviCRM)
    ‚Üì
APIv4 Contact/Contribution/Participant Create
    ‚Üì
CiviRules Trigger
    ‚Üì
Actions (Email, Tag, Activity)
    ‚Üì
n8n Webhook (optional)
    ‚Üì
External Systems (Mailchimp, Analytics)
```

---

## üìö Dokumentation

### User Guides
- `docs/civicrm/user-guide/SPENDEN.md` - Spendenformular nutzen
- `docs/civicrm/user-guide/MITGLIED_WERDEN.md` - Mitgliedschaft beantragen
- `docs/civicrm/user-guide/PROFIL.md` - Profil-Self-Service

### Admin Guides
- `docs/civicrm/admin/SEARCHKIT.md` - Dashboards verwalten
- `docs/civicrm/admin/BANKING.md` - Banking-Import
- `docs/civicrm/admin/SEPA.md` - SEPA-Batches

### Developer Docs
- `docs/civicrm/developer/APIv4.md` - API-Referenz
- `docs/civicrm/developer/HOOKS.md` - Custom Hooks
- `docs/civicrm/developer/EXTENSIONS.md` - Genutzte Extensions

---

## üéØ Next Steps

1. ‚úÖ Interface-Struktur dokumentiert
2. ‚è≥ SearchKit Dashboards implementieren (API-Definitionen)
3. ‚è≥ Webforms erstellen & CiviCRM-Handler konfigurieren
4. ‚è≥ Integrationen aktivieren (siehe integrations/)
5. ‚è≥ CiviRules aufsetzen
6. ‚è≥ User Acceptance Testing (UAT)

---

<div align="center">
  <br />
  <strong>üèõÔ∏è CiviCRM Interface Ready for Implementation</strong>
  <br />
  <sub>Dokumentation: v1.0 | 11. Oktober 2025</sub>
</div>
