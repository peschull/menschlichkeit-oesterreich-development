# PR Review Comment Template

## {{status_emoji}} PR Validation Report

**PR:** #{{pr_number}}  
**Status:** {{status}}  
**Timestamp:** {{timestamp}}  
**Environment:** {{environment}}  
**Agent:** merge-bot

---

## 📋 Validation Checks

### ✅ Passed Checks
{{passed_checks}}

### ❌ Failed Checks
{{failed_checks}}

### ⚠️ Warnings
{{warnings}}

---

## 🔍 Detailed Results

### Secrets Manifest
- **Status:** {{secrets_status}}
- **Version:** {{secrets_version}}
- **Secrets Count:** {{secrets_count}}
- **Issues:** {{secrets_issues}}

### Codacy Configuration
- **Status:** {{codacy_status}}
- **YAML Indentation:** {{yaml_indentation}}
- **Duplicate Tools:** {{duplicate_tools}}
- **Issues:** {{codacy_issues}}

### Merge Conflicts
- **Status:** {{conflicts_status}}
- **Conflicting Files:** {{conflict_count}}
- **Critical Paths:** 
  - `.github/workflows/*.yml`
  - `package.json`
  - `docs/archive/*`

### Quality Gates
- **Overall Status:** {{quality_gates_status}}
- **Duplication:** {{duplication_percentage}}%
- **Security:** {{security_status}}
- **Performance:** {{performance_status}}

---

## 🚀 Next Steps

{{#if validation_passed}}
### ✅ Validation Passed - Ready for Merge

1. **Audit Tag:** `audit:pr-{{pr_number}}:validated` has been created
2. **Log Location:** `logs/audit/PR-{{pr_number}}-{{timestamp}}.txt`
3. **Merge Strategy:** Squash & Merge recommended
4. **Post-Merge:** Automatic cleanup of feature branch

**Merge Command:**
```bash
gh pr merge {{pr_number}} --squash --delete-branch
```
{{else}}
### ❌ Validation Failed - Action Required

1. **Review Logs:** Check `logs/conflicts/PR-{{pr_number}}.txt` for details
2. **Fix Issues:** Address all failed checks and warnings
3. **Re-validate:** Push fixes to trigger automatic re-validation
4. **Rollback Option:** Use `prompts/rollback-masterprompt.md` if needed

**Common Issues:**
- Merge conflicts in workflows or package.json
- Secrets manifest validation errors
- YAML indentation problems (use 2 spaces, not tabs)
- Duplicate tool definitions in Codacy config
{{/if}}

---

## 📊 Quality Metrics

| Metric | Target | Actual | Status |
|--------|--------|--------|--------|
| Duplication | ≤ 3% | {{duplication}}% | {{duplication_status}} |
| Security Alerts | 0 | {{security_alerts}} | {{security_status}} |
| YAML Linting | Pass | {{yaml_lint}} | {{yaml_status}} |
| Conflict Resolution | 0 files | {{conflicts}} files | {{conflict_status}} |

---

## 🔒 Security & Compliance

- **Secrets Exposure:** {{secrets_exposure_status}}
- **DSGVO Compliance:** {{dsgvo_status}}
- **Access Level:** {{access_level}} (stage environment)
- **Approval Required:** {{approval_required}}

---

## 📝 Audit Trail

- **Validation ID:** `val-{{validation_id}}`
- **User:** @{{user}}
- **Branch:** `{{branch}}`
- **Commit SHA:** `{{commit_sha}}`
- **Workflow Run:** [#{{run_number}}]({{run_url}})

---

<details>
<summary>🔧 Troubleshooting Guide</summary>

### Merge Conflict Resolution
```bash
# Fetch latest changes
git fetch origin

# Rebase on target branch
git rebase origin/main

# Resolve conflicts manually
# Then continue
git rebase --continue
```

### Secrets Validation Issues
```bash
# Validate secrets manifest locally
pwsh scripts/validate-pr.ps1 -Environment stage -DryRun

# Check JSON syntax
cat secrets.manifest.json | jq .
```

### YAML Indentation Fix
```bash
# Auto-fix YAML indentation (2 spaces)
yamllint -c .yamllint.yml --fix .codacy/codacy.yaml
```

</details>

---

**Generated by:** merge-bot validator  
**Documentation:** [PR Validation Guide](.github/instructions/pr-validation.md)  
**Support:** Create issue with label `merge-bot`
