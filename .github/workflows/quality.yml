name: Quality

on:
  push:
    name: Quality

    on:
      push:
        branches: ["**"]     # optional: einschränken (z.B. main, develop)
      pull_request:
      workflow_dispatch:

    permissions:
      contents: read

    jobs:
      quality:
        name: Lint & Checks
        runs-on: ubuntu-latest
        timeout-minutes: 15

        steps:
          - name: Checkout
            uses: actions/checkout@v4

          - name: Setup Node.js
            uses: actions/setup-node@v4
            with:
              node-version: "20"
              cache: npm

          # Install VOR Lint (install-before-lint)
          - name: Install dependencies
            run: |
              if [ -f package-lock.json ]; then
                npm ci
              else
                npm install
              fi

          - name: ESLint
            if: ${{ hashFiles('**/.eslintrc*') != '' }}
            run: |
              npx eslint . --max-warnings=0

          - name: Prettier (Check)
            if: ${{ hashFiles('**/.prettierrc*') != '' || hashFiles('**/prettier.config.*') != '' }}
            run: |
              npx prettier -c .

          - name: TypeScript (noEmit)
            if: ${{ hashFiles('**/tsconfig.json') != '' }}
            run: |
              npx tsc -noEmit

          - name: Tests
            if: ${{ hashFiles('**/package.json') != '' }}
            run: |
              if npm run | grep -qE '(^|\s)test($|\s)'; then
                npm test --silent
              else
                echo "No test script in package.json — skipping."
              fi
  name: Code Quality
