/**
 * Democracy Metaverse - Extended Level Content
 * Detaillierte Dialoge, Follow-Up Szenarien und Lernmodule
 * f√ºr Level 1-10 (Kapitel 1: Nachbarschaft)
 */

class ExtendedLevelContent {
  constructor() {
    this.followUpScenarios = this.initializeFollowUps();
    this.characterDialogues = this.initializeDialogues();
    this.learningModules = this.initializeLearningModules();

    console.log('üìö Extended Level Content loaded');
  }

  /**
   * Follow-Up Szenarien basierend auf Entscheidungen
   */
  initializeFollowUps() {
    return {
      // Level 1: L√§rm im Hof
      empathetic_solution: {
        narrative: 'Drei Wochen sp√§ter klopft dein Nachbar von oben an deine T√ºr.',
        dialogue:
          'Hey, danke nochmal f√ºr das Gespr√§ch damals. Ich dachte, du solltest wissen - ich habe Kopfh√∂rer gekauft f√ºr abends.',
        effect:
          'Die empathische Herangehensweise hat eine dauerhafte positive Beziehung geschaffen.',
        valueGain: { empathy: +1, participation: +1 },
      },

      rule_enforcement: {
        narrative: 'Der Hausverwalter hat neue strikte Ruhezeiten eingef√ºhrt.',
        dialogue: 'Beschwerde-Hotline eingerichtet. Verst√∂√üe werden mit Abmahnungen geahndet.',
        effect: 'Ruhe herrscht, aber die Nachbarschaftsbeziehungen sind angespannt.',
        valueGain: { rights: +1, empathy: -1 },
      },

      // Level 3: M√ºll oder Kultur?
      community_building: {
        narrative: 'Ein Monat sp√§ter h√§ngt ein bunter Aushang im Hausflur.',
        dialogue:
          "Einladung zum 'Kultur-Caf√©': Jede Familie stellt ihre Traditionen vor. Mit Snacks aus aller Welt!",
        effect: 'Aus dem Konflikt ist ein Nachbarschaftsprojekt geworden.',
        valueGain: { empathy: +2, participation: +2 },
      },

      conflict_escalation: {
        narrative: 'Die Situation hat sich versch√§rft.',
        dialogue:
          "Familie Hassan: 'Wir f√ºhlen uns hier nicht willkommen. Wir √ºberlegen umzuziehen.'",
        effect: 'Diskriminierung f√ºhrt zu Verlust von Vielfalt in der Nachbarschaft.',
        valueGain: { empathy: -2, participation: -1 },
      },

      // Level 4: Nachbarschaftshilfe
      community_network: {
        narrative: 'Die Nachbarschaftshilfe-WhatsApp-Gruppe ist aktiv.',
        dialogue:
          '15 Nachbarn helfen sich gegenseitig. Von Kinderbetreuung bis Einkaufen - alles organisiert.',
        effect: 'Systematische Solidarit√§t macht alle st√§rker.',
        valueGain: { participation: +2, empathy: +1 },
      },

      social_isolation: {
        narrative: 'Frau Weber ist gest√ºrzt.',
        dialogue: 'Sie lag 6 Stunden hilflos in ihrer Wohnung. Niemand hat nach ihr gesehen.',
        effect: 'Fehlende Solidarit√§t hat reale Konsequenzen.',
        valueGain: { empathy: -2, participation: -2 },
      },

      // Level 5: Hundekonflikt
      time_sharing: {
        narrative: 'Das neue System funktioniert perfekt.',
        dialogue: 'Hundezeit: 7-9 Uhr und 17-19 Uhr. Kinderzeit: 9-17 Uhr. Alle sind zufrieden!',
        effect: 'Kompromisse k√∂nnen alle Bed√ºrfnisse erf√ºllen.',
        valueGain: { participation: +2, empathy: +1 },
      },

      dismissive_attitude: {
        narrative: 'Familie Schmidt meidet den Innenhof.',
        dialogue: 'Kind entwickelt Angst vor Hunden. Familie f√ºhlt sich nicht ernst genommen.',
        effect: 'Ignorieren von Bed√ºrfnissen schafft neue Probleme.',
        valueGain: { empathy: -2, participation: -1 },
      },

      // Level 7: Stra√üenfest
      democratic_organizing: {
        narrative: 'Das Fest war ein riesiger Erfolg!',
        dialogue:
          '50 Nachbarn haben mitgeholfen. Sogar Herr Grimmig war da und hat Schach gespielt!',
        effect: 'Partizipative Organisation schafft Gemeinschaftsgef√ºhl.',
        valueGain: { participation: +3, empathy: +2 },
      },

      top_down_organizing: {
        narrative: 'Das Fest fand statt, aber...',
        dialogue: 'Nur 12 Leute waren da. Die meisten f√ºhlten sich nicht einbezogen.',
        effect: 'Top-down-Planung f√ºhrt zu geringer Beteiligung.',
        valueGain: { participation: -2, empathy: -1 },
      },

      // Level 8: Mediation
      professional_mediation: {
        narrative: 'Der Konflikt wurde gel√∂st.',
        dialogue:
          'Frau K√∂nig und Herr Pfeifer haben einen Parkplatz-Tauschplan entwickelt. Sie reden wieder miteinander!',
        effect: 'Professionelle Mediation schafft nachhaltige L√∂sungen.',
        valueGain: { participation: +2, empathy: +2 },
      },

      taking_sides: {
        narrative: 'Der Konflikt ist eskaliert.',
        dialogue:
          'Jetzt gibt es zwei Lager im Haus. Die H√§lfte spricht nicht mehr mit der anderen H√§lfte.',
        effect: 'Partei ergreifen spaltet die Gemeinschaft.',
        valueGain: { participation: -2, empathy: -1 },
      },
    };
  }

  /**
   * Charakter-Dialoge f√ºr immersive Erfahrungen
   */
  initializeDialogues() {
    return {
      // Hausbewohner*innen Charaktere
      characters: {
        frau_weber: {
          name: 'Frau Weber',
          age: 78,
          background: 'Pensionierte Lehrerin, wohnt seit 45 Jahren im Haus',
          personality: 'Freundlich aber zur√ºckhaltend, braucht Hilfe aber will nicht betteln',
          dialogues: {
            greeting: 'Ach, hallo! Wie nett, dass Sie fragen...',
            help_accepted:
              'Das ist so lieb von Ihnen. Ich wei√ü gar nicht, wie ich das zur√ºckgeben soll...',
            help_refused: 'Ach, das schaffe ich schon... irgendwie...',
            gratitude: 'Sie haben mir so geholfen. Das vergesse ich nicht.',
          },
        },

        herr_grimmig: {
          name: 'Herr Grimmig',
          age: 67,
          background: 'Verwitweter Rentner, fr√ºher Maschinenbauingenieur',
          personality: 'Verschlossen, verletzt, sehnt sich nach Gemeinschaft aber zeigt es nicht',
          dialogues: {
            defensive: 'Was wollen Sie denn? Lassen Sie mich in Ruhe!',
            softening: 'Hmm... vielleicht haben Sie nicht ganz unrecht...',
            vulnerable: 'Seit Gertrud tot ist... ist es so still hier...',
            transformation: 'Wissen Sie was? Vielleicht k√∂nnte ich doch mal vorbeischauen...',
          },
        },

        familie_hassan: {
          name: 'Familie Hassan',
          background: 'Samir (35), Layla (33), Kinder Amira (8) und Yusuf (5)',
          personality: 'Offen, kulturell stolz, wollen dazugeh√∂ren aber auch authentisch bleiben',
          dialogues: {
            cultural_pride:
              'Diese Teppiche sind von meiner Gro√ümutter. Sie bedeuten uns sehr viel.',
            hurt: 'Wir versuchen nur, uns zuhause zu f√ºhlen. Ist das zu viel verlangt?',
            grateful: 'Danke, dass Sie unsere Kultur respektieren. Das bedeutet uns alles.',
            invitation:
              'M√∂chten Sie mal auf einen Tee vorbeikommen? Layla macht die besten Baklava!',
          },
        },

        familie_schmidt: {
          name: 'Familie Schmidt',
          background: 'Marcus (29), Julia (27), Tochter Lea (4)',
          personality: 'Junge Eltern, vorsichtig aber fair, wollen das Beste f√ºr ihr Kind',
          dialogues: {
            concern:
              'Verstehen Sie, Lea ist noch so klein. Sie hat wirklich Angst vor gro√üen Hunden.',
            compromise: 'Wenn wir eine L√∂sung finden, die f√ºr alle funktioniert, sind wir dabei.',
            relief:
              'So ist es perfekt! Lea kann sicher spielen und die Hunde haben auch ihren Raum.',
            gratitude: 'Danke, dass Sie unsere Sorgen ernst genommen haben.',
          },
        },
      },

      // Situationsspezifische Dialoge
      situations: {
        noise_conflict_evening: [
          "Nachbar: 'Entschuldigung, ist die Musik zu laut?'",
          "Du: 'Ein bisschen schon, ich muss morgen fr√ºh raus...'",
          "Nachbar: 'Oh, das wusste ich nicht. Ich drehe sofort leiser.'",
        ],

        cultural_decoration_discussion: [
          "Herr Mueller: 'Das sieht hier aus wie auf dem Basar!'",
          "Frau Hassan: 'Das ist unsere Kultur. Haben wir kein Recht darauf?'",
          'Du: [Deine Entscheidung beeinflusst den weiteren Dialog]',
        ],

        mediation_session: [
          "Du: 'Danke, dass Sie beide gekommen sind. Lassen Sie uns zuh√∂ren, was jeder braucht.'",
          "Frau K√∂nig: 'Ich brauche den Parkplatz f√ºr meine Mutter im Rollstuhl!'",
          "Herr Pfeifer: 'Und ich zahle seit 10 Jahren Miete f√ºr diesen Platz!'",
          'Du: [Wie f√ºhrst du die Mediation weiter?]',
        ],
      },
    };
  }

  /**
   * Interaktive Lernmodule f√ºr vertieftes Verstehen
   */
  initializeLearningModules() {
    return {
      empathy_training: {
        title: 'Empathie-Training',
        description: 'Lerne verschiedene Perspektiven zu verstehen',
        exercises: [
          {
            type: 'perspective_switch',
            scenario: 'Nachbar spielt laute Musik',
            perspectives: [
              {
                role: 'Studentin',
                viewpoint: 'Muss f√ºr Pr√ºfung lernen, braucht Ruhe, traut sich nicht zu beschweren',
              },
              {
                role: 'Musiker',
                viewpoint: 'Arbeitet von zuhause, √ºbt f√ºr Auftritt, wei√ü nicht um St√∂rung',
              },
              {
                role: 'Rentner',
                viewpoint: 'H√∂rger√§t macht Ger√§usche lauter, aber freut sich √ºber Leben im Haus',
              },
            ],
          },
        ],
      },

      conflict_resolution: {
        title: 'Konflikte l√∂sen',
        description: 'Methoden f√ºr konstruktive Konfliktl√∂sung',
        steps: [
          '1. Aktives Zuh√∂ren - beide Seiten verstehen',
          '2. Gemeinsame Interessen finden',
          '3. Win-Win-L√∂sungen entwickeln',
          '4. Vereinbarungen treffen und √ºberpr√ºfen',
        ],
        practice_scenarios: [
          'L√§rm-Konflikt',
          'Parkplatz-Streit',
          'Hausordnung-Diskussion',
          'Kulturelle Unterschiede',
        ],
      },

      participation_methods: {
        title: 'Partizipation organisieren',
        description: 'Wie man Menschen erfolgreich beteiligt',
        methods: [
          {
            name: 'Open Space Technology',
            description: 'Selbstorganisierte Diskussionsrunden',
            use_case: 'Nachbarschaftstreffen planen',
          },
          {
            name: 'World Caf√© Methode',
            description: 'Rotierende Kleingruppen-Gespr√§che',
            use_case: 'Verschiedene Themen gleichzeitig diskutieren',
          },
          {
            name: 'Konsensus-Entscheidung',
            description: 'Entscheidungen, die alle mittragen k√∂nnen',
            use_case: 'Hausordnung gemeinsam entwickeln',
          },
        ],
      },

      democratic_values: {
        title: 'Demokratische Werte verstehen',
        description: 'Was Demokratie im Alltag bedeutet',
        values: [
          {
            name: 'Empathie',
            explanation: 'Andere Perspektiven verstehen und respektieren',
            daily_practice: 'Vor Entscheidungen fragen: Wie geht es den anderen damit?',
          },
          {
            name: 'Rechtsstaatlichkeit',
            explanation: 'Faire Regeln f√ºr alle, die transparent angewendet werden',
            daily_practice: 'Regeln hinterfragen: Sind sie fair und f√ºr alle gleich?',
          },
          {
            name: 'Partizipation',
            explanation: 'Alle Betroffenen in Entscheidungen einbeziehen',
            daily_practice: 'Fragen: Wer ist noch betroffen und sollte mitreden?',
          },
          {
            name: 'Zivilcourage',
            explanation: 'Aufstehen f√ºr Werte, auch wenn es schwer ist',
            daily_practice: 'Bei Unrecht nicht wegschauen, sondern handeln',
          },
        ],
      },
    };
  }

  /**
   * Get Follow-Up content based on player choice
   */
  getFollowUp(followUpId) {
    return this.followUpScenarios[followUpId] || null;
  }

  /**
   * Get character dialogue
   */
  getCharacterDialogue(characterId, situationId) {
    const character = this.dialogues.characters[characterId];
    if (!character) return null;

    return character.dialogues[situationId] || null;
  }

  /**
   * Get learning module
   */
  getLearningModule(moduleId) {
    return this.learningModules[moduleId] || null;
  }

  /**
   * Calculate long-term consequences based on multiple choices
   */
  calculateLongTermConsequences(playerChoices) {
    let consequences = {
      neighborhood_harmony: 0,
      individual_relationships: {},
      community_initiatives: [],
      conflicts_resolved: 0,
      conflicts_created: 0,
    };

    playerChoices.forEach(choice => {
      // Analyze choice impact
      if (choice.values) {
        if (choice.values.empathy > 0 && choice.values.participation > 0) {
          consequences.neighborhood_harmony += 2;
        }
        if (choice.values.empathy < 0 || choice.values.participation < 0) {
          consequences.neighborhood_harmony -= 1;
        }
      }

      // Track relationship building
      if (choice.followUp && choice.followUp.includes('community')) {
        consequences.community_initiatives.push(choice.followUp);
      }
    });

    return consequences;
  }
}

// Initialize when DOM is ready
if (typeof window !== 'undefined') {
  window.extendedContent = null;

  document.addEventListener('DOMContentLoaded', () => {
    window.extendedContent = new ExtendedLevelContent();
    console.log('‚úÖ Extended Level Content ready!');
  });
}

// Export for module usage
if (typeof module !== 'undefined' && module.exports) {
  module.exports = ExtendedLevelContent;
}
