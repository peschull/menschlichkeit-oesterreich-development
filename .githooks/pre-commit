#!/usr/bin/env bash
# Pre-Commit-Hook: Blockt echte .env-Dateien (schützt vor Secrets-Commits)
# Aktivieren: git config core.hooksPath .githooks && chmod +x .githooks/pre-commit

set -euo pipefail

blocked=$(git diff --cached --name-only | grep -E '(^|/)\.env($|[^a-z])' | grep -v '\.example' || true)

if [ -n "$blocked" ]; then
  echo "❌ COMMIT ABGEBROCHEN: Echte .env-Dateien gefunden (Secrets-Schutz)!"
  echo ""
  echo "Betroffene Dateien:"
  echo "$blocked"
  echo ""
  echo "Lösung:"
  echo "  1. git reset HEAD <datei>  # Unstage .env"
  echo "  2. Prüfe .gitignore (muss .env enthalten)"
  echo "  3. Nutze .env.example für Templates"
  echo ""
  exit 1
fi

echo "✅ Keine echten .env-Dateien im Commit (Secrets-Check passed)"
exit 0
